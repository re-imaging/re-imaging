{% extends 'base.html' %}

{% block content %}

  <!-- test mathjax -->
  <!-- $J(x)=\int_0^1\alpha_x(\dot x)dt$ -->

  <div id="sbar">
  <!-- class="d-flex flex-column p-3 bg-light" -->

    <ul>
      <!-- class="flex-column mb-auto ml-0" -->
      <h1 class="fs-3 mt-3"><a id="main-title" href={{ url_for("core.get_images") }}>ImageMesh</a></h1>
      <!-- <h1><a href={{ url_for("core.get_images") }}>{% block title %}arXiv Images{% endblock %}</a></h1> -->

      <div class="row">
        <div id="selected_image" class="selected-image shadow"></div>
      </div>

      <div class="row">
        <div id="selected-image-meta" class="selected-image-meta-box"></div>
      </div>

      <hr/>

      <div class="row">
        <div style="clear: both;"></div>
        <div id="main-form" class="form-inline" onsubmit="$('#loading-spinner').removeClass('d-none');">
          <form name="search" method="post">
            <div class="form-group" id="search-mode-form">
              <h2 class="fs-4">Search the dataset:</h2>

              <div class="btn-group col-12 d-none" role="group" aria-label="Button to toggle searching by sampling or nearest neighbours">
                <input type="radio" class="btn-check" name="btnradio" id="sample-btn" autocomplete="off" checked>
                <label class="btn btn-outline-primary" for="sample-btn">Sample dataset</label>

                <input type="radio" class="btn-check" name="btnradio" id="nn-btn" autocomplete="off">
                <label class="btn btn-outline-primary" for="nn-btn">Nearest neighbours</label>
              </div>

              <div>
                <label for="search-mode">Search mode</label>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                  <label class="form-check-label" for="flexRadioDefault1">
                    Random sample
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked>
                  <label class="form-check-label" for="flexRadioDefault2">
                    Nearest Neighbours
                  </label>
                </div>
              </div>

              <!-- <div id="toggle-div" class="mt-2"> -->
                <div id=random-text class="d-none" style="display: inline-block;">
                  <p class="d-none">Sample dataset</p>
                  <!-- <p style="font-size: 1.25em; vertical-align: top;">Sample dataset</p> -->
                </div>

                <label class="switch d-none"> <!-- d-none -->
                  <input type="checkbox" name="search_select" id="search_select" value='on' onclick="toggleMode();" class="d-none">
                  <span class="slider round d-none"></span>
                </label>

                <!-- <div class="input-form"> -->
                  <div id=embedding-text class="input-group mt-3 mb-2">
                    <!-- <div class="col align-bottom"> -->
                    <label for="embedding">ML embedding</label>
                    <!-- class="input-group-text" -->
                    <!-- </div> -->
                    <div class="col">
                      <select class="form-select" name="embedding" id="embedding">
                        <option value="ternary">ternary</option>
                        <option value="VGG16">VGG16</option>
                        <option value="raw">raw</option>
                        <option value="cats">cats</option>
                      </select>
                    </div>
                    <!-- <span style="font-size: 1.25em; vertical-align: top;">ML Embedding
                  		<select class="form-select" name="embedding" id="embedding" style="vertical-align: middle; margin: 0;">
                        <option value="ternary">ternary</option>
                        <option value="VGG16">VGG16</option>
                        <option value="raw">raw</option>
                        <option value="cats">cats</option>
                      </select>
                    </span> -->
                  </div>
                <!-- </div> -->

                <div class="row">
                  <div class="col d-none">
                    <label for="image_id" id="image_id_label" class="align-bottom">Target image</label>
                  </div>
                  <div class="col d-none">
                    <input class="col" style="float: right;"for="image_id" name="image_id" id="image_id" placeholder="Click on an image" type="number">
                  </div>
                </div>
                <!-- style="vertical-align: middle; max-width: 160px;" -->
              </div>
            <!-- </div> -->

            <div class="category-dropdown">
              <label for="category">Archive and category</label>
              <div style="display: inline-block; vertical-align: text-bottom;" data-toggle="tooltip" data-placement="right"
                title="Search by archive and category (subject area). Listed according to the arXiv category taxonomy. Searches first-listed category only.">
                <i class="bi bi-info-circle"></i>
              </div>
              <input type="text" name="category" id="category" placeholder="Select an archive (subject area)...">
            </div>

            <div class="category-name-dropdown">
              <label for="category" class="d-none">Category</label>
              <!-- <div style="display: inline-block; vertical-align: text-bottom;" data-toggle="tooltip" data-placement="right"
                title="Search using the article category (specific subject area). Categories are listed according to the arXiv category taxonomy. Searches first-listed category only.">
                <i class="bi bi-info-circle"></i>
              </div> -->
              <input type="text" name="category-name" id="category-name" placeholder="Select a category...">
            </div>

            <div id="filter-div">
              <button id="filter-btn" type="button" class="btn btn-light mt-4 mb-1 collapsible" data-toggle="collapse" data-target="#filter-content">Optional filters <i id="filter-icon" class="bi bi-caret-down"></i></button>

              <div id="filter-content" class="filter-content collapse form-group">
                <!-- row 1 -->
                <!-- <div class="row"> -->

                  <div class="col">
                    <div class="author-filter">
                      <label for="author">Author</label>
                      <div style="display: inline-block; vertical-align: text-bottom;" data-toggle="tooltip" data-placement="right"
                        title="Search the authors field of the arXiv article metadata. Searches all authors. The number indicates total number of matching images in this data subset.">
                        <i class="bi bi-info-circle"></i>
                      </div>
                      <input type="text" name="author" id="author" placeholder="Search by author...">
                    </div>
                  </div>

                  <div class="col">
                    <div class="caption-filter">
                      <label for="caption-filter">Caption</label>
                      <input type="caption" name="caption" id="caption" placeholder="Search by caption keyword...">
                    </div>
                  </div>
                <!-- </div> -->

                <!-- row 2 -->
                <!-- <div class="row"> -->
                  <div class="col">
                    <div class="date-filter">
                      <span><label for="date-start">Date range</label></span>
                      <div style="display: block; margin-bottom: 0.5rem;">
                        <input type="date" id="date-start" name="date-start" min="1986-01-01" max="2020-06-30">
                        -
                        <input type="date" id="date-end" name="date-end" min="1986-01-01" max="2020-06-30">
                      </div>
                    </div>
                  </div>

                  <div class="col">
                    <div class="title-filter">
                      <label for="title">Paper title</label>
                      <input type="text" name="title" id="title" placeholder="Search by title keyword...">
                    </div>
                  </div>

                  <div class="col">
                    <div class="prediction">
                      <label for="prediction">VGG prediction</label>
                      <div style="display: inline-block; vertical-align: text-bottom;" data-toggle="tooltip" data-placement="right"
                        title="Search the predictions made by a VGG16 classifier that was trained on ImageNet. Searches only the top-1 prediction.">
                        <i class="bi bi-info-circle"></i>
                      </div>
                      <input type="text" name="prediction" id="prediction" placeholder="Search by VGG16 prediction...">
                    </div>
                  </div>
                <!-- </div> -->

                <!-- row 3 -->
                <!-- <div class="row"> -->
                  <div class="col">
                    <div class="creator-filter">
                      <label for="creator">Creator/Software</label>
                      <div style="display: inline-block; vertical-align: text-bottom;" data-toggle="tooltip" data-placement="right"
                        title="Filter by the 'creator' or 'software' field in the image metadata. The number indicates total number of matching images in this data subset.">
                        <i class="bi bi-info-circle"></i>
                      </div>
                      <input type="text" name="creator" id="creator" placeholder="Search by software creator field...">
                    </div>
                  </div>

                  <div class="col">
                    <div class="imageformat-dropdown">
                      <label for="imageformat">Image format</label>
                      <select type="text" name="imageformat" id="imageformat" placeholder="Select an imageformat...">
                        <option value="">Select an imageformat...</option>
                        <option value="PNG">PNG</option>
                        <option value="PDF">PDF</option>
                        <option value="JPEG">JPEG</option>
                        <option value="GIF">GIF</option>
                        <option value="SVG">SVG</option>
                        <option value="PS">PS</option>
                        <option value="EPS">EPS</option>
                      </select>
                    </div>
                  </div>
                <!-- </div> -->

              </div>

              <!-- <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
                <label class="form-check-label" for="flexRadioDefault1">
                  Default radio
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked>
                <label class="form-check-label" for="flexRadioDefault2">
                  Default checked radio
                </label>
              </div> -->

              <div id="search-button-div" class="d-flex justify-content-between">
                <input type="submit" class="btn btn-light mt-2 mb-2 mr-2 btn-outline-primary" name="btn" value="Search images" id="search-images">
                <div id="loading-spinner" class="spinner-border d-none" role="status" style="margin-top: auto; margin-bottom: auto;">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <!-- justify-content-between -->
              <!-- class="d-flex justify-content-between" -->

            </div>
          </form>


        </div>
      </div>

    </ul>
  </div>

  <div id="description-text" class="mt-2" style="display: block; position: relative; left: 360px; top: 0px; margin-bottom: 1em; width: calc(100% - 360px);">


    <div class="row mx-2">
      {% if prev_image_id %}
        {% if result_total %}
          <div class="alert alert-secondary col-11" role="alert">
          {% if not embedding %}
            {% set search_mode_text = "results by sampling dataset from {} total matching images".format(result_total) %}
          {% else %}
            {% set search_mode_text = "nearest results to the selected image from {} total matching images using {} embedding".format(result_total, embedding) %}
          {% endif %}
          {{ "Showing {} {}".format(images_shown, search_mode_text) }}
          </div>
        {% else %}
          <div class="alert alert-secondary col-11" role="alert">
          {% if not embedding %}
            {% set search_mode_text = "results by sampling dataset" %}
          {% else %}
            {% set search_mode_text = "nearest results to the selected image by {} embedding".format(embedding) %}
          {% endif %}
          {{ "Showing {} {}".format(images_shown, search_mode_text) }}
          </div>
        {% endif %}
      {% else %}
        <div class="alert alert-secondary col-11" role="alert">
          Showing sample of images from arXiv - a preprint repository for the sciences.
        </div>
      {% endif %}

      <!-- navigation menu   -->
      <nav id="nav-menu" class="nav col-1 mr-2" style="z-index: 999;">
        <div class="container-fluid">
          <!-- <a class="navbar-brand" href="#">Reconfiguring</a> -->
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('core.about') }}">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="{{ url_for('core.get_images') }}">Interface</a>
          </li>
        </div>
      </nav>

      {% if not prev_image_id %}
        <div class="alert alert-primary col-12" role="alert">
          Click on an image to see metadata. Double click to select to use for nearest neighbour search using machine learning embeddings.
        </div>
      {% endif %}

      </div>
      <hr class="mx-2">
    </div>

	<div style="display:block; top:50%; right: 50%; position:fixed; z-index: 999" class="spinner-border text-primary mx-auto" role="status" id="loading"></div>

  <div id="image-grid" class="image-grid">
    {% for i, image in enumerate(images) %}
      {% if metadata[i][8]|length > 100 %}
        {% set authors_short = metadata[i][8].split(";")[0] + " et al" %}
      {% else %}
        {% set authors_short = metadata[i][8] %}
      {% endif %}
      {% set pl = metadata[i][10].lower().replace(","," ").split() %}
      {% set prediction_formatted = "{} {}<br>{} {}<br>{} {}<br>{} {}<br>{} {}".format(pl[1], pl[0], pl[3], pl[2], pl[5], pl[4], pl[7], pl[6], pl[9], pl[8]) %}
      {# {% set abstract_short = metadata[i][12] %} #}
      {# [:100] + "..." #}
      {% if metadata[i][11] != "None" %}
        {% set caption = metadata[i][11] %}
      {% else %}
        {% set caption = "-" %}
      {% endif %}

      <!-- title="Metadata" data-sanitize="false" data-toggle="popover" data-html="true" -->
      <div class="grid-item" image_id={{image.split(".")[0]}}>
        <img class="grid-item-img" src={{url_for("static", filename="web/"+image+".jpg")}}
          prediction="{{ prediction_formatted }}" tab-data="
          <ul class='nav nav-tabs' id='tab-{{image}}' role='tablist'>
            <li class='nav-item' role='presentation'>
              <a class='nav-link tab-link active' id='tab-id' image-id='{{image}}' data-toggle='tab' href='#{{image}}-id' role='tab' aria-controls='id' aria-selected='true'>ID</a>
            </li>
            <li class='nav-item' role='presentation'>
              <a class='nav-link tab-link' id='tab-fm' image-id='{{image}}' data-toggle='tab' href='#{{image}}-format' role='tab' aria-controls='format' aria-selected='false'>Format</a>
            </li>
            <li class='nav-item' role='presentation'>
              <a class='nav-link tab-link' id='tab-cp' image-id='{{image}}' data-toggle='tab' href='#{{image}}-caption' role='tab' aria-controls='caption' aria-selected='false'>Caption</a>
            </li>
          </ul>

          <div class='tab-content' id='tab-content-{{image}}'>
            <div class='tab-pane fade show active' id='tab-{{image}}-id' role='tabpanel' aria-labelledby='id-tab'>
              <b>identifier:</b> <a href=https://arxiv.org/abs/{{metadict[image]['identifier']|e}}>{{metadict[image]['identifier']|e}}</a><br><b>date:</b> {{metadict[image]['created']|e}}<br><b>category:</b> {{metadict[image]['cat']|e}}<br><b>authors:</b> {{authors_short|e}}<br><b>title:</b> {{metadict[image]['title']|e}}<br>
              </div>
            <div class='tab-pane fade' id='tab-{{image}}-fm' role='tabpanel' aria-labelledby='format-tab'>
              <b>filename:</b> {{metadict[image]['filename']|e}}<br><b>x:</b> {{metadict[image]['x']|e}}<b> y:</b> {{metadict[image]['y']|e}}<br><b>format:</b> {{metadict[image]['imageformat']|e}}<br><b>creator:</b> {{metadict[image]['creator']|e}}<br>
            </div>
            <div class='tab-pane fade' id='tab-{{image}}-cp' role='tabpanel' aria-labelledby='caption-tab'>
              <b>caption:</b> {{caption|e}}<br>
            </div>
          </div>"
        >
      </div>
    {%- endfor %}
  </div>

  <!-- <li class='nav-item' role='presentation'>
    <a class='nav-link tab-link' id='tab-hide' image-id='{{image}}' data-toggle='tab' href='#{{image}}-hide' role='tab' aria-controls='hide' aria-selected='false'>x</a>
  </li> -->

  <script>

  // function openTab(evt, tabName) {
  //   var i, tabcontent, tablinks;
  //   tabcontent = document.getElementsByClassName("tabcontent");
  //   for (i = 0; i < tabcontent.length; i++) {
  //     tabcontent[i].style.display = "none";
  //   }
  //   tablinks = document.getElementsByClassName("tablinks");
  //   for (i = 0; i < tablinks.length; i++) {
  //     tablinks[i].className = tablinks[i].className.replace(" active", "");
  //   }
  //   document.getElementById(cityName).style.display = "block";
  //   evt.currentTarget.className += " active";
  // }

  function toggleMode() {
    let checkbox = document.getElementById('search_select');
    console.log("checkbox: " + checkbox.checked)
    // let sampleButton = $('#sample-btn');
    // let nnButton = $('#nn-btn');
    let gray = "#cccccc"
    let black = "#000000"
    if(checkbox.checked == 1) {
      document.getElementById("random-text").style.color = gray;
      document.getElementById("embedding-text").style.color = black;
      document.getElementById("image_id_label").style.color = black;
      document.getElementById("embedding").disabled = false;
      document.getElementById("image_id").disabled = false;
      // $('#sample-btn').removeClass('active');
      // $('#nn-btn').addClass('active');
      $('#nn-btn').click();
    } else if (checkbox.checked == 0) {
      document.getElementById("random-text").style.color = black;
      document.getElementById("embedding-text").style.color = gray;
      document.getElementById("image_id_label").style.color = gray;
      document.getElementById("embedding").disabled = true;
      document.getElementById("image_id").disabled = true;
      // $('#nn-btn').removeClass('active');
      // $('#sample-btn').addClass('active');
      $('#sample-btn').click();
    }
  }

  Selectize.define('enter_key_submit', function (options) {
    var self = this;

    this.onKeyDown = (function (e) {
      var original = self.onKeyDown;

      return function (e) {
        // this.items.length MIGHT change after event propagation.
        // We need the initial value as well. See next comment.
        var initialSelection = this.items.length;
        original.apply(this, arguments);

        if (e.keyCode === 13
            // Necessary because we don't want this to be triggered when an option is selected with Enter after pressing DOWN key to trigger the dropdown options
            && initialSelection && initialSelection === this.items.length
            && this.$control_input.val() === '') {
          self.trigger('submit');
        }
      };
    })();
  });

  $(document).ready(function(){
    const checkbox = document.getElementById('search_select');

    $('#sample-btn').on('click', function(event) {
      console.log("sample-btn pressed");
      let checkbox = document.getElementById('search_select');
      if(checkbox.checked == 1) {
        checkbox.checked = 0;
        toggleMode();
      }
      else {
        return;
      }
    });

    $('#nn-btn').on('click', function(event) {
      console.log("nn-btn pressed");
      let checkbox = document.getElementById('search_select');
      if(checkbox.checked == 0) {
        checkbox.checked = 1;
        toggleMode();
      }
      else {
        return;
      }
    });

    // init Packery
    var $grid = $('.image-grid').packery({
      itemSelector: '.grid-item',
      gutter: 8,
      transitionDuration: 0,
    });
    // layout Packery after each image loads
    $grid.imagesLoaded().progress( function() {
      $grid.packery();
    });

    // $('main-form').on('submit', function ( event, form, response ) {
    //   console.log("form submitted");
    //   var $load = $('#loading-spinner');
    //   $load.removeClass('d-none');
      // $load.addClass('d-block');
    // });

    function show_selected(img_src, img_data, img_prediction) {
      $("#selected_image").css("height", "324px");
      $("#selected-block").css("display", "block");
      let img_src_html = '<img src=' + img_src + ' style="object-fit: contain; max-width: 100%; max-height: 100%;">';
      console.log(img_src_html);
      $("#selected_image").empty().append(img_src_html);
      console.log("prediction: " + img_prediction);
      $('#selected_image').popover('dispose');
      $("#selected_image").popover({
        content: img_prediction,
        title: 'VGG16 prediction',
        html: true,
        trigger: 'click',
        placement: 'right',
      });

      let checkbox = document.getElementById('search_select');
      if( checkbox.checked == 0) {
        console.log('toggle unchecked, calling toggleMode');
        checkbox.checked = 1;
        toggleMode();
      }

      $("#selected-image-meta").empty().append(img_data);

      $('.si-tab-link').on("click", function (event) {
        console.log("si-tab link clicked");
        let imageID = $(this).attr('image-id');
        let tabID = $(this).attr('id');
        console.log("imageID: " + imageID);
        console.log("tabID: " + tabID);
        let tabSelector = tabID.substring(7, 9);
        console.log("tabSelector: " + tabSelector);
        let targetTabID = "#si-tab-content-" + imageID;
        console.log(targetTabID);
        $( targetTabID ).children().removeClass( "show active" );
        let targetTabContent = '#si-tab-' + imageID + '-' + tabSelector;
        console.log("targetTabContent: " + targetTabContent);
        $( targetTabContent ).addClass( "show active" );
      });

      MathJax.typeset();
    }

    $(".grid-item-img").on("dblclick", function (event) {
      $(this).toggleClass("active");
      $(".grid-item-img").not(this).removeClass("active");
      var img_src = $(this).attr("src");
      var img_id = $(this).parent().attr("image_id");
      // var img_data = $(this).attr("data-content");
      var img_data = $(this).attr("tab-data");
      img_data = img_data.replace(/id='tab-/g, "id='si-tab-");
      img_data = img_data.replace(/tab-link/g, "si-tab-link");

      console.log("img_data: " + img_data);
      var img_pred = $(this).attr("prediction");
      // console.log("showing selected image: " + img_src);
      show_selected(img_src, img_data, img_pred);

      console.log("setting image_id to: " + img_id);
      console.log("prediction: " + img_pred);
      $("#image_id").val(img_id);
      $(".results").empty().append(img_id);
    });

    $(".grid-item-img").on("click", function (event) {
      console.log('disposing popovers');
      $(".grid-item-img").not(this).popover('dispose');
      console.log('creating popover');
      console.log(this);
      let imgDiv = '<img class="popover-image" src="' + $(this).attr('src') + '">';
      let tabData = $(this).attr('tab-data');
      let popoverData = imgDiv + tabData;
      console.log("popoverData: " + popoverData);
      $(this).popover({
        html: true,
        trigger: 'manual',
        title: 'Image Metadata <button type="button" class="btn-close position-absolute top-0 end-0 mt-1 mb-1" aria-label="Close"></button>',
        sanitize: false,
        // selector: '[rel=selector]',
        // placement: "bottom",
        content: popoverData,
      });
      $(document).on("click", ".popover .btn-close" , function(){
          $(this).parents(".popover").popover('hide');
      });

      $(".grid-item-img").not(this).popover('hide');
      $(this).popover('show');

      $('.tab-link').on("click", function (event) {
        console.log("link clicked");
        let imageID = $(this).attr('image-id');
        let tabID = $(this).attr('id');
        console.log("imageID: " + imageID);
        console.log("tabID: " + tabID);
        let tabSelector = tabID.substring(4, 6);
        console.log("tabSelector: " + tabSelector);
        let targetTabID = "#tab-content-" + imageID;
        console.log(targetTabID);
        $( targetTabID ).children().removeClass( "show active" );
        let targetTabContent = '#tab-' + imageID + '-' + tabSelector;
        console.log("targetTabContent: " + targetTabContent);
        $( targetTabContent ).addClass( "show active" );
      });
    })

    {% if prev_image_id %}
      console.log("prev_image_id not empty: " + {{ prev_image_id }});
      var img_src = {{url_for("static", filename="all/"+prev_image_id+".jpg")|tojson}};
      {% if si_meta[8]|length > 100 %}
        {% set si_authors_short = si_meta[8].split(";")[0] + " et al" %}
      {% else %}
        {% set si_authors_short = si_meta[8] %}
      {% endif %}
      {% if si_meta[11] != "None" %}
        {% set si_caption = si_meta_d[prev_image_id]['caption']|e %}
      {% else %}
        {% set si_caption = "-" %}
      {% endif %}
      {% set pl = si_meta[10].lower().replace(","," ").split() %}
      {% set si_prediction_formatted = "{} {}<br>{} {}<br>{} {}<br>{} {}<br>{} {}".format(pl[1], pl[0], pl[3], pl[2], pl[5], pl[4], pl[7], pl[6], pl[9], pl[8]) %}
      var img_pred = '{% autoescape false %} {{ si_prediction_formatted }} {% endautoescape %}';
      // var img_data = {{"<div class='meta-col'><b><em>Image</em><br>filename:</b> {}<br><b>x:</b> {}<b> y:</b> {}<br><b>format:</b> {}<br><b>creator:</b> {}<br><br></div><div class='meta-col'><b><em>Paper</em><br>identifier:</b> <a href=https://arxiv.org/abs/{}>{}</a><br><b>date:</b> {}<br><b>category:</b> {}<br><b>authors:</b> {}<br><b>title:</b> {}<br><br></div><div class='meta-col'><b><em>Figure</em><br>caption:</b> {}".format(si_meta[1], si_meta[2], si_meta[3], si_meta[4], si_meta[5], si_meta[0], si_meta[0], si_meta[6], si_meta[7], si_authors_short, si_meta[9], si_caption)|tojson }};
      var img_data =
        "<ul class='nav nav-tabs' id='tab-{{prev_image_id}}' role='tablist'>" +
          "<li class='nav-item' role='presentation'>" +
            "<a class='nav-link tab-link active' id='tab-id' image-id='{{prev_image_id}}' data-toggle='tab' href='#{{prev_image_id}}-id' role='tab' aria-controls='id' aria-selected='true'>ID</a>" +
          "</li>" +
          "<li class='nav-item' role='presentation'>" +
            "<a class='nav-link tab-link' id='tab-fm' image-id='{{prev_image_id}}' data-toggle='tab' href='#{{prev_image_id}}-format' role='tab' aria-controls='format' aria-selected='false'>Format</a>" +
          "</li>" +
          "<li class='nav-item' role='presentation'>" +
            "<a class='nav-link tab-link' id='tab-cp' image-id='{{prev_image_id}}' data-toggle='tab' href='#{{prev_image_id}}-caption' role='tab' aria-controls='caption' aria-selected='false'>Caption</a>" +
          "</li>" +
        "</ul>" +

        "<div class='tab-content' id='tab-content-{{prev_image_id}}'>" +
          "<div class='tab-pane fade show active' id='tab-{{prev_image_id}}-id' role='tabpanel' aria-labelledby='id-tab'>" +
            "<b>identifier:</b> <a href=https://arxiv.org/abs/{{si_meta_d[prev_image_id]['identifier']|e}}>{{si_meta_d[prev_image_id]['identifier']|e}}</a><br><b>date:</b> {{si_meta_d[prev_image_id]['created']|e}}<br><b>category:</b> {{si_meta_d[prev_image_id]['cat']|e}}<br><b>authors:</b> {{si_authors_short|e}}<br><b>title:</b> {{si_meta_d[prev_image_id]['title']|e}}<br>" +
            "</div>" +
          "<div class='tab-pane fade' id='tab-{{prev_image_id}}-fm' role='tabpanel' aria-labelledby='format-tab'>" +
           "<b>filename:</b> {{si_meta_d[prev_image_id]['filename']|e}}<br><b>x:</b>" + "{{si_meta_d[prev_image_id]['x']|e}}<b> y:</b> {{si_meta_d[prev_image_id]['y']|e}}<br><b>format:</b> {{si_meta_d[prev_image_id]['imageformat']|e}}<br><b>creator:</b> {{si_meta_d[prev_image_id]['creator']|e}}<br>" +
          "</div>" +
          "<div class='tab-pane fade' id='tab-{{prev_image_id}}-cp' role='tabpanel' aria-labelledby='caption-tab'>" +
            "<b>caption:</b> {{si_caption|e}}<br>" +
          "</div>" +
        "</div>";
      // console.log(img_data);

      img_data = img_data.replace(/id='tab-/g, "id='si-tab-");
      img_data = img_data.replace(/tab-link/g, "si-tab-link");

      show_selected(img_src, img_data, img_pred);

      // $('.si-tab-link').on("click", function (event) {
      //   console.log("si-tab link clicked");
      //   let imageID = $(this).attr('image-id');
      //   let tabID = $(this).attr('id');
      //   console.log("imageID: " + imageID);
      //   console.log("tabID: " + tabID);
      //   let tabSelector = tabID.substring(7, 9);
      //   console.log("tabSelector: " + tabSelector);
      //   let targetTabID = "#si-tab-content-" + imageID;
      //   console.log(targetTabID);
      //   $( targetTabID ).children().removeClass( "show active" );
      //   let targetTabContent = '#si-tab-' + imageID + '-' + tabSelector;
      //   console.log("targetTabContent: " + targetTabContent);
      //   $( targetTabContent ).addClass( "show active" );
      // });

    {% else %}
      $("#selected-block").css("display", "none");
    {% endif %}

    var $select = $('#author').selectize({
      delimiter: ',',
      persist: false,
      maxItems: 1,
      plugins: ['remove_button', 'enter_key_submit'],
      onInitialize: function () {
        this.on('submit', function () {
          this.$input.closest('form').submit();
        }, this);
      },
      valueField: 'cat',
      labelField: 'label',
      searchField: ['cat', 'label'],
      render: {
        item: function(item, escape) {
            return '<div>' +
                (item.cat ? '<span class="cat">' + escape(item.cat) + ' - </span>' : '') +
                (item.label ? '<span class="label">' + escape(item.label) + '</span>' : '') +
            '</div>';
        },
        option: function(item, escape) {
            var label = item.cat || item.label;
            var caption = item.cat ? item.label : null;
            return '<div>' +
                '<span class="label">' + escape(label) + ' - </span>' +
                (caption ? '<span class="caption">' + escape(caption) + '</span>' : '') +
            '</div>';
        }
      },
      create: function(input) {
          return {
              cat: input,
              label: input
          }
      }
    });
    var authorSelect = $select[0].selectize;

    var $select = $('#prediction').selectize({
      delimiter: ',',
      persist: false,
      maxItems: 1,
      plugins: ['remove_button', 'enter_key_submit'],
      onInitialize: function () {
        this.on('submit', function () {
          this.$input.closest('form').submit();
        }, this);
      },
      valueField: 'cat',
      labelField: 'label',
      searchField: ['cat', 'label'],
      options: [
        {'cat': 'oscilloscope', 'label': '86013'}, {'cat': 'web_site', 'label': '78592'}, {'cat': 'rule', 'label': '62818'}, {'cat': 'slide_rule', 'label': '53678'}, {'cat': 'envelope', 'label': '44853'}, {'cat': 'menu', 'label': '33113'}, {'cat': 'bow', 'label': '18544'}, {'cat': 'nematode', 'label': '14257'}, {'cat': 'crane', 'label': '14243'}, {'cat': 'binder', 'label': '11379'}, {'cat': 'spider_web', 'label': '8914'}, {'cat': 'maze', 'label': '7299'}, {'cat': 'crossword_puzzle', 'label': '6993'}, {'cat': 'swing', 'label': '6722'}, {'cat': 'hook', 'label': '6273'}, {'cat': 'jigsaw_puzzle', 'label': '5996'}, {'cat': 'wall_clock', 'label': '5708'}, {'cat': 'analog_clock', 'label': '4913'}, {'cat': 'stupa', 'label': '3418'}, {'cat': 'necklace', 'label': '3414'}, {'cat': 'scale', 'label': '3238'}, {'cat': 'syringe', 'label': '3044'}, {'cat': 'chime', 'label': '3002'}, {'cat': 'screwdriver', 'label': '2922'}, {'cat': 'shower_curtain', 'label': '2425'}, {'cat': 'pole', 'label': '2362'}, {'cat': 'magnetic_compass', 'label': '2209'}, {'cat': 'tripod', 'label': '2134'}, {'cat': 'traffic_light', 'label': '1975'}, {'cat': 'window_screen', 'label': '1830'}, {'cat': 'digital_clock', 'label': '1787'}, {'cat': 'nail', 'label': '1743'}, {'cat': 'whistle', 'label': '1554'}, {'cat': 'switch', 'label': '1465'}, {'cat': 'chain', 'label': '1431'}, {'cat': 'bubble', 'label': '1304'}, {'cat': 'fountain', 'label': '1287'}, {'cat': 'picket_fence', 'label': '1255'}, {'cat': 'safety_pin', 'label': '1249'}, {'cat': 'gong', 'label': '1120'}, {'cat': 'parachute', 'label': '1075'}, {'cat': 'harvestman', 'label': '1058'}, {'cat': 'matchstick', 'label': '1057'}, {'cat': 'handkerchief', 'label': '1050'}, {'cat': 'book_jacket', 'label': '1023'}, {'cat': 'jellyfish', 'label': '999'}, {'cat': 'rubber_eraser', 'label': '908'}, {'cat': 'spotlight', 'label': '887'}, {'cat': 'abacus', 'label': '885'}, {'cat': 'chainlink_fence', 'label': '876'}, {'cat': 'solar_dish', 'label': '855'}, {'cat': 'pinwheel', 'label': '814'}, {'cat': 'scoreboard', 'label': '813'}, {'cat': 'microphone', 'label': '782'}, {'cat': 'hair_slide', 'label': '756'}, {'cat': 'balloon', 'label': '748'}, {'cat': 'coil', 'label': '724'}, {'cat': 'cleaver', 'label': '722'}, {'cat': 'pick', 'label': '720'}, {'cat': 'wardrobe', 'label': '714'}, {'cat': 'plate_rack', 'label': '694'}, {'cat': 'honeycomb', 'label': '689'}, {'cat': 'screw', 'label': '646'}, {'cat': 'ski', 'label': '620'}, {'cat': 'window_shade', 'label': '601'}, {'cat': 'corkscrew', 'label': '600'}, {'cat': 'fountain_pen', 'label': '592'}, {'cat': 'maypole', 'label': '582'}, {'cat': 'monitor', 'label': '576'}, {'cat': 'walking_stick', 'label': '576'}, {'cat': 'umbrella', 'label': '574'}, {'cat': 'candle', 'label': '570'}, {'cat': 'bow_tie', 'label': '541'}, {'cat': 'bib', 'label': '534'}, {'cat': 'pirate', 'label': '530'}, {'cat': 'horizontal_bar', 'label': '509'}, {'cat': 'prayer_rug', 'label': '489'}, {'cat': 'flagpole', 'label': '483'}, {'cat': 'oboe', 'label': '480'}, {'cat': 'suit', 'label': '479'}, {'cat': 'swab', 'label': '471'}, {'cat': 'power_drill', 'label': '448'}, {'cat': 'ballpoint', 'label': '447'}, {'cat': 'volcano', 'label': '426'}, {'cat': 'wig', 'label': '426'}, {'cat': 'sliding_door', 'label': '425'}, {'cat': 'measuring_cup', 'label': '416'}, {'cat': 'fire_screen', 'label': '407'}, {'cat': 'jersey', 'label': '407'}, {'cat': 'Band_Aid', 'label': '401'}, {'cat': 'radio_telescope', 'label': '394'}, {'cat': 'prison', 'label': '387'}, {'cat': 'mouse', 'label': '384'}, {'cat': 'shoji', 'label': '383'}, {'cat': 'street_sign', 'label': '381'}, {'cat': 'brassiere', 'label': '379'}, {'cat': 'Windsor_tie', 'label': '372'}, {'cat': 'container_ship', 'label': '372'}, {'cat': 'carton', 'label': '363'}, {'cat': 'mask', 'label': '359'}, {'cat': 'puck', 'label': '358'}, {'cat': 'quill', 'label': '350'}, {'cat': 'electric_fan', 'label': '348'}, {'cat': 'bell_cote', 'label': '342'}, {'cat': 'doormat', 'label': '342'}, {'cat': 'iPod', 'label': '342'}, {'cat': 'sombrero', 'label': '337'}, {'cat': 'bee_eater', 'label': '335'}, {'cat': 'sundial', 'label': '334'}, {'cat': 'remote_control', 'label': '324'}, {'cat': 'Petri_dish', 'label': '322'}, {'cat': 'airship', 'label': '322'}, {'cat': 'pencil_sharpener', 'label': '311'}, {'cat': 'tray', 'label': '311'}, {'cat': 'lampshade', 'label': '309'}, {'cat': 'rifle', 'label': '302'}, {'cat': 'toilet_seat', 'label': '298'}, {'cat': 'stage', 'label': '297'}, {'cat': 'red_wine', 'label': '294'}, {'cat': 'loupe', 'label': '293'}, {'cat': 'loudspeaker', 'label': '292'}, {'cat': 'croquet_ball', 'label': '290'}, {'cat': 'folding_chair', 'label': '287'}, {'cat': 'ping-pong_ball', 'label': '285'}, {'cat': 'seashore', 'label': '280'}, {'cat': 'mortarboard', 'label': '278'}, {'cat': 'cricket', 'label': '276'}, {'cat': 'lacewing', 'label': '270'}, {'cat': 'wallet', 'label': '266'}, {'cat': 'bolo_tie', 'label': '265'}, {'cat': 'slot', 'label': '264'}, {'cat': 'stole', 'label': '260'}, {'cat': 'suspension_bridge', 'label': '258'}, {'cat': 'warplane', 'label': '256'}, {'cat': 'strainer', 'label': '254'}, {'cat': 'bathing_cap', 'label': '253'}, {'cat': 'face_powder', 'label': '252'}, {'cat': 'lighter', 'label': '249'}, {'cat': 'modem', 'label': '249'}, {'cat': 'cassette', 'label': '245'}, {'cat': 'stethoscope', 'label': '244'}, {'cat': 'poncho', 'label': '243'}, {'cat': 'dishrag', 'label': '242'}, {'cat': 'screen', 'label': '237'}, {'cat': 'pillow', 'label': '236'}, {'cat': 'streetcar', 'label': '236'}, {'cat': 'theater_curtain', 'label': '231'}, {'cat': 'shoe_shop', 'label': '228'}, {'cat': 'stopwatch', 'label': '226'}, {'cat': 'clog', 'label': '219'}, {'cat': 'ant', 'label': '218'}, {'cat': 'lipstick', 'label': '218'}, {'cat': 'long-horned_beetle', 'label': '218'}, {'cat': 'comic_book', 'label': '213'}, {'cat': 'punching_bag', 'label': '213'}, {'cat': 'paper_towel', 'label': '211'}, {'cat': 'radiator', 'label': '210'}, {'cat': 'tennis_ball', 'label': '205'}, {'cat': 'velvet', 'label': '205'}, {'cat': 'desk', 'label': '202'}, {'cat': 'knot', 'label': '199'}, {'cat': 'bonnet', 'label': '198'}, {'cat': 'castle', 'label': '198'}, {'cat': 'shield', 'label': '198'}, {'cat': 'iron', 'label': '196'}, {'cat': 'harp', 'label': '194'}, {'cat': 'shower_cap', 'label': '194'}, {'cat': 'chain_mail', 'label': '185'}, {'cat': 'torch', 'label': '181'}, {'cat': 'golf_ball', 'label': '179'}, {'cat': 'padlock', 'label': '176'}, {'cat': 'toyshop', 'label': '173'}, {'cat': 'computer_keyboard', 'label': '172'}, {'cat': 'lab_coat', 'label': '166'}, {'cat': 'pencil_box', 'label': '166'}, {'cat': 'pug', 'label': '166'}, {'cat': 'soccer_ball', 'label': '165'}, {'cat': 'refrigerator', 'label': '164'}, {'cat': 'file', 'label': '162'}, {'cat': 'lakeside', 'label': '160'}, {'cat': 'paintbrush', 'label': '158'}, {'cat': 'tiger_beetle', 'label': '158'}, {'cat': 'palace', 'label': '156'}, {'cat': 'schooner', 'label': '155'}, {'cat': 'turnstile', 'label': '154'}, {'cat': 'letter_opener', 'label': '153'}, {'cat': 'sock', 'label': '153'}, {'cat': 'fireboat', 'label': '151'}, {'cat': 'television', 'label': '150'}, {'cat': 'washbasin', 'label': '150'}, {'cat': 'wool', 'label': '147'}, {'cat': 'apron', 'label': '145'}, {'cat': 'library', 'label': '145'}, {'cat': 'dumbbell', 'label': '144'}, {'cat': 'maraca', 'label': '144'}, {'cat': 'cockroach', 'label': '141'}, {'cat': 'sea_urchin', 'label': '141'}, {'cat': 'vase', 'label': '140'}, {'cat': 'barbell', 'label': '139'}, {'cat': "jack-o'-lantern", 'label': '138'}, {'cat': 'parallel_bars', 'label': '138'}, {'cat': 'wine_bottle', 'label': '137'}, {'cat': 'brass', 'label': '136'}, {'cat': 'tick', 'label': '135'}, {'cat': 'cinema', 'label': '134'}, {'cat': 'racket', 'label': '133'}, {'cat': 'geyser', 'label': '132'}, {'cat': 'church', 'label': '131'}, {'cat': 'packet', 'label': '131'}, {'cat': 'bucket', 'label': '129'}, {'cat': 'starfish', 'label': '129'}, {'cat': 'garbage_truck', 'label': '126'}, {'cat': 'space_shuttle', 'label': '126'}, {'cat': 'broom', 'label': '124'}, {'cat': 'sarong', 'label': '124'}, {'cat': 'bannister', 'label': '123'}, {'cat': 'cash_machine', 'label': '122'}, {'cat': 'shopping_basket', 'label': '121'}, {'cat': 'liner', 'label': '118'}, {'cat': 'bottlecap', 'label': '117'}, {'cat': 'manhole_cover', 'label': '117'}, {'cat': 'alp', 'label': '116'}, {'cat': 'centipede', 'label': '116'}, {'cat': 'hourglass', 'label': '116'}, {'cat': 'perfume', 'label': '116'}, {'cat': 'dam', 'label': '115'}, {'cat': 'toilet_tissue', 'label': '115'}, {'cat': 'neck_brace', 'label': '114'}, {'cat': 'washer', 'label': '114'}, {'cat': 'bassoon', 'label': '113'}, {'cat': 'birdhouse', 'label': '113'}, {'cat': 'balance_beam', 'label': '112'}, {'cat': 'conch', 'label': '111'}, {'cat': 'sweatshirt', 'label': '111'}, {'cat': 'mitten', 'label': '109'}, {'cat': 'safe', 'label': '109'}, {'cat': 'cliff', 'label': '108'}, {'cat': 'fur_coat', 'label': '107'}, {'cat': 'laptop', 'label': '107'}, {'cat': 'vending_machine', 'label': '107'}, {'cat': 'beacon', 'label': '106'}, {'cat': 'beaker', 'label': '106'}, {'cat': 'electric_guitar', 'label': '105'}, {'cat': 'space_heater', 'label': '105'}, {'cat': 'sunglasses', 'label': '103'}, {'cat': 'vault', 'label': '102'}, {'cat': 'abaya', 'label': '100'}, {'cat': 'pay-phone', 'label': '100'}, {'cat': 'pier', 'label': '100'}, {'cat': 'dragonfly', 'label': '99'}
      ],
      render: {
        item: function(item, escape) {
            return '<div>' +
                (item.cat ? '<span class="cat">' + escape(item.cat) + ' </span>' : '') +
                (item.label ? '<span class="label small">(' + escape(item.label) + ' in total)</span>' : '') +
            '</div>';
        },
        option: function(item, escape) {
            var label = item.cat || item.label;
            var caption = item.cat ? item.label : null;
            return '<div>' +
                '<span class="label">' + escape(label) + ' </span>' +
                (caption ? '<span class="caption small">(' + escape(caption) + ' in total)</span>' : '') +
            '</div>';
        }
      },
      create: function(input) {
          return {
              cat: input,
              label: input
          }
      }
    });
    var predictionSelect = $select[0].selectize;

    var categoryNameSettings = {
      delimiter: ',',
      persist: false,
      maxItems: 1,
      plugins: ['remove_button', 'enter_key_submit'],
      onInitialize: function () {
        this.on('submit', function () {
          this.$input.closest('form').submit();
        }, this);
      },
      valueField: 'cat',
      labelField: 'label',
      searchField: ['cat', 'label'],
      options: [],
        // {'cat': 'astro-ph.GA', 'label': 'Astrophysics of Galaxies'}, {'cat': 'astro-ph.CO', 'label': 'Cosmology and Nongalactic Astrophysics'}, {'cat': 'astro-ph.EP', 'label': 'Earth and Planetary Astrophysics'}, {'cat': 'astro-ph.HE', 'label': 'High Energy Astrophysical Phenomena'}, {'cat': 'astro-ph.IM', 'label': 'Instrumentation and Methods for Astrophysics'}, {'cat': 'astro-ph.SR', 'label': 'Solar and Stellar Astrophysics'}
      render: {
        item: function(item, escape) {
            return '<div>' +
                (item.cat ? '<span class="cat">' + escape(item.cat) + ' - </span>' : '') +
                (item.label ? '<span class="label">' + escape(item.label) + '</span>' : '') +
            '</div>';
        },
        option: function(item, escape) {
            var label = item.cat || item.label;
            var caption = item.cat ? item.label : null;
            return '<div>' +
                '<span class="label">' + escape(label) + ' - </span>' +
                (caption ? '<span class="caption">' + escape(caption) + '</span>' : '') +
            '</div>';
        }
      },
      create: function(input) {
          return {
              cat: input,
              label: input
          }
      }
    };

    var $select = $('#category-name').selectize(categoryNameSettings);
    var categoryNameSelect = $select[0].selectize;

    // {'cat': 'astro-ph.GA', 'label': 'Astrophysics of Galaxies'}, {'cat': 'astro-ph.CO', 'label': 'Cosmology and Nongalactic Astrophysics'}, {'cat': 'astro-ph.EP', 'label': 'Earth and Planetary Astrophysics'}, {'cat': 'astro-ph.HE', 'label': 'High Energy Astrophysical Phenomena'}, {'cat': 'astro-ph.IM', 'label': 'Instrumentation and Methods for Astrophysics'}, {'cat': 'astro-ph.SR', 'label': 'Solar and Stellar Astrophysics'}

    var $select = $('#category').selectize({
        delimiter: ',',
        persist: false,
        maxItems: 1,
        plugins: ['remove_button', 'enter_key_submit'],
        onInitialize: function () {
          this.on('submit', function () {
            this.$input.closest('form').submit();
          }, this);
        },
        valueField: 'cat',
        labelField: 'label',
        searchField: ['cat', 'label'],
        options: [
          {'cat': 'cs', 'label': 'Computer Science'}, {'cat': 'econ', 'label': 'Economics'}, {'cat': 'eess', 'label': 'Electrical Engineering and Systems Science'}, {'cat': 'math', 'label': 'Mathematics'}, {'cat': 'astro-ph', 'label': 'Physics: Astrophysics'}, {'cat': 'cond-mat', 'label': 'Physics: Condensed Matter'}, {'cat': 'gr-qc', 'label': 'Physics: General Relativity and Quantum Cosmology'}, {'cat': 'hep-ex', 'label': 'High Energy Physics - Experiment'}, {'cat': 'hep-lat', 'label': 'High Energy Physics - Lattice'}, {'cat': 'hep-ph', 'label': 'High Energy Physics - Phenomenology'}, {'cat': 'hep-th', 'label': 'High Energy Physics - Theory'}, {'cat': 'nlin', 'label': 'Physics: Nonlinear Sciences'}, {'cat': 'nucl-ex', 'label': 'Physics: Nuclear Experiment'}, {'cat': 'nucl-th', 'label': 'Physics: Nuclear Theory'}, {'cat': 'physics', 'label': 'Physics'}, {'cat': 'quant-ph', 'label': 'Quantum Physics'}, {'cat': 'math-ph', 'label': 'Mathematical Physics'}, {'cat': 'q-bio', 'label': 'Quantitative Biology'}, {'cat': 'q-fin', 'label': 'Quantitative Finance'}, {'cat': 'stat', 'label': 'Statistics'}
        ],
        onChange: function(value) {
          console.log("calling loadCategoryName w value: " + value);
          loadCategoryName(value);
        },
        render: {
          item: function(item, escape) {
            return '<div>' +
                (item.cat ? '<span class="cat">' + escape(item.cat) + ' - </span>' : '') +
                (item.label ? '<span class="label">' + escape(item.label) + '</span>' : '') +
            '</div>';
          },
          option: function(item, escape) {
            var label = item.cat || item.label;
            var caption = item.cat ? item.label : null;
            return '<div>' +
                '<span class="label">' + escape(label) + ' - </span>' +
                (caption ? '<span class="caption">' + escape(caption) + '</span>' : '') +
            '</div>';
          }
        },
        create: function(input) {
          return {
              cat: input,
              label: input
          }
        }
    });
    var categorySelect = $select[0].selectize;

    function loadCategoryName(archive) {
/*
      var categoryNameOptions = {
        'cs': [
          {'cat': 'cs.AI', 'label': 'Artificial Intelligence'}, {'cat': 'cs.CL', 'label': 'Computation and Language'}, {'cat': 'cs.CC', 'label': 'Computational Complexity'}, {'cat': 'cs.CE', 'label': 'Computational Engineering, Finance, and Science'}, {'cat': 'cs.CG', 'label': 'Computational Geometry'}, {'cat': 'cs.GT', 'label': 'Computer Science and Game Theory'}, {'cat': 'cs.CV', 'label': 'Computer Vision and Pattern Recognition'}, {'cat': 'cs.CY', 'label': 'Computers and Society'}, {'cat': 'cs.CR', 'label': 'Cryptography and Security'}, {'cat': 'cs.DS', 'label': 'Data Structures and Algorithms'}, {'cat': 'cs.DB', 'label': 'Databases'}, {'cat': 'cs.DL', 'label': 'Digital Libraries'}, {'cat': 'cs.DM', 'label': 'Discrete Mathematics'}, {'cat': 'cs.DC', 'label': 'Distributed, Parallel, and Cluster Computing'}, {'cat': 'cs.ET', 'label': 'Emerging Technologies'}, {'cat': 'cs.FL', 'label': 'Formal Languages and Automata Theory'}, {'cat': 'cs.GL', 'label': 'General Literature'}, {'cat': 'cs.GR', 'label': 'Graphics'}, {'cat': 'cs.AR', 'label': 'Hardware Architecture'}, {'cat': 'cs.HC', 'label': 'Human-Computer Interaction'}, {'cat': 'cs.IR', 'label': 'Information Retrieval'}, {'cat': 'cs.IT', 'label': 'Information Theory'}, {'cat': 'cs.LG', 'label': 'Learning'}, {'cat': 'cs.LO', 'label': 'Logic in Computer Science'}, {'cat': 'cs.MS', 'label': 'Mathematical Software'}, {'cat': 'cs.MA', 'label': 'Multiagent Systems'}, {'cat': 'cs.MM', 'label': 'Multimedia'}, {'cat': 'cs.NI', 'label': 'Networking and Internet Architecture'}, {'cat': 'cs.NE', 'label': 'Neural and Evolutionary Computing'}, {'cat': 'cs.NA', 'label': 'Numerical Analysis'}, {'cat': 'cs.OS', 'label': 'Operating Systems'}, {'cat': 'cs.OH', 'label': 'Other Computer Science'}, {'cat': 'cs.PF', 'label': 'Performance'}, {'cat': 'cs.PL', 'label': 'Programming Languages'}, {'cat': 'cs.RO', 'label': 'Robotics'}, {'cat': 'cs.SI', 'label': 'Social and Information Networks'}, {'cat': 'cs.SE', 'label': 'Software Engineering'}, {'cat': 'cs.SD', 'label': 'Sound'}, {'cat': 'cs.SC', 'label': 'Symbolic Computation'}, {'cat': 'cs.SY', 'label': 'Systems and Control'}
        ],
        'astro-ph': [
          {'cat': 'astro-ph.GA', 'label': 'Astrophysics of Galaxies'}, {'cat': 'astro-ph.CO', 'label': 'Cosmology and Nongalactic Astrophysics'}, {'cat': 'astro-ph.EP', 'label': 'Earth and Planetary Astrophysics'}, {'cat': 'astro-ph.HE', 'label': 'High Energy Astrophysical Phenomena'}, {'cat': 'astro-ph.IM', 'label': 'Instrumentation and Methods for Astrophysics'}, {'cat': 'astro-ph.SR', 'label': 'Solar and Stellar Astrophysics'}
        ],
        'cond-mat': [
          {'cat': 'cond-mat.dis-nn', 'label': 'Disordered Systems and Neural Networks'}, {'cat': 'cond-mat.mtrl-sci', 'label': 'Materials Science'}, {'cat': 'cond-mat.mes-hall', 'label': 'Mesoscale and Nanoscale Physics'}, {'cat': 'cond-mat.other', 'label': 'Other Condensed Matter'}, {'cat': 'cond-mat.quant-gas', 'label': 'Quantum Gases'}, {'cat': 'cond-mat.soft', 'label': 'Soft Condensed Matter'}, {'cat': 'cond-mat.stat-mech', 'label': 'Statistical Mechanics'}, {'cat': 'cond-mat.str-el', 'label': 'Strongly Correlated Electrons'}, {'cat': 'cond-mat.supr-con', 'label': 'Superconductivity'}
        ],
        'gr-qc': [
          {'cat': 'gr-qc', 'label': 'General Relativity and Quantum Cosmology'}
        ],
        'hep-ex': [
          {'cat': 'hep-ex', 'label': 'High Energy Physics - Experiment'}
        ],
        'hep-lat': [
          {'cat': 'hep-lat', 'label': 'High Energy Physics - Lattice'}
        ],
        'hep-ph': [
          {'cat': 'hep-ph', 'label': 'High Energy Physics - Phenomenology'}
        ],
        'hep-th': [
          {'cat': 'hep-th', 'label': 'High Energy Physics - Theory'}
        ],
        'math-ph': [
           {'cat': 'math-ph', 'label': 'Mathematical Physics'}
         ],
         'nlin.AO': [
           {'cat': 'nlin.AO', 'label': 'Adaptation and Self-Organizing Systems'}
         ],
         'nlin.CG': [
           {'cat': 'nlin.CG', 'label': 'Cellular Automata and Lattice Gases'}
         ],
         'nlin.CD': [
           {'cat': 'nlin.CD', 'label': 'Chaotic Dynamics'}
         ],
         'nlin.SI': [
           {'cat': 'nlin.SI', 'label': 'Exactly Solvable and Integrable Systems'}
         ],
         {'cat': 'nlin.PS', 'label': 'Pattern Formation and Solitons'}, {'cat': 'nucl-ex', 'label': 'Nuclear Experiment'}, {'cat': 'nucl-th', 'label': 'Nuclear Theory'}, {'cat': 'physics.acc-ph', 'label': 'Accelerator Physics'}, {'cat': 'physics.app-ph', 'label': 'Applied Physics'}, {'cat': 'physics.ao-ph', 'label': 'Atmospheric and Oceanic Physics'}, {'cat': 'physics.atom-ph', 'label': 'Atomic Physics'}, {'cat': 'physics.atm-clus', 'label': 'Atomic and Molecular Clusters'}, {'cat': 'physics.bio-ph', 'label': 'Biological Physics'}, {'cat': 'physics.chem-ph', 'label': 'Chemical Physics'}, {'cat': 'physics.class-ph', 'label': 'Classical Physics'}, {'cat': 'physics.comp-ph', 'label': 'Computational Physics'}, {'cat': 'physics.data-an', 'label': 'Data Analysis, Statistics and Probability'}, {'cat': 'physics.flu-dyn', 'label': 'Fluid Dynamics'}, {'cat': 'physics.gen-ph', 'label': 'General Physics'}, {'cat': 'physics.geo-ph', 'label': 'Geophysics'}, {'cat': 'physics.hist-ph', 'label': 'History and Philosophy of Physics'}, {'cat': 'physics.ins-det', 'label': 'Instrumentation and Detectors'}, {'cat': 'physics.med-ph', 'label': 'Medical Physics'}, {'cat': 'physics.optics', 'label': 'Optics'}, {'cat': 'physics.ed-ph', 'label': 'Physics Education'}, {'cat': 'physics.soc-ph', 'label': 'Physics and Society'}, {'cat': 'physics.plasm-ph', 'label': 'Plasma Physics'}, {'cat': 'physics.pop-ph', 'label': 'Popular Physics'}, {'cat': 'physics.space-ph', 'label': 'Space Physics'}, {'cat': 'quant-ph', 'label': 'Quantum Physics'}, {'cat': 'math.AG', 'label': 'Algebraic Geometry'}, {'cat': 'math.AT', 'label': 'Algebraic Topology'}, {'cat': 'math.AP', 'label': 'Analysis of PDEs'}, {'cat': 'math.CT', 'label': 'Category Theory'}, {'cat': 'math.CA', 'label': 'Classical Analysis and ODEs'}, {'cat': 'math.CO', 'label': 'Combinatorics'}, {'cat': 'math.AC', 'label': 'Commutative Algebra'}, {'cat': 'math.CV', 'label': 'Complex Variables'}, {'cat': 'math.DG', 'label': 'Differential Geometry'}, {'cat': 'math.DS', 'label': 'Dynamical Systems'}, {'cat': 'math.FA', 'label': 'Functional Analysis'}, {'cat': 'math.GM', 'label': 'General Mathematics'}, {'cat': 'math.GN', 'label': 'General Topology'}, {'cat': 'math.GT', 'label': 'Geometric Topology'}, {'cat': 'math.GR', 'label': 'Group Theory'}, {'cat': 'math.HO', 'label': 'History and Overview'}, {'cat': 'math.IT', 'label': 'Information Theory'}, {'cat': 'math.KT', 'label': 'K-Theory and Homology'}, {'cat': 'math.LO', 'label': 'Logic'}, {'cat': 'math.MP', 'label': 'Mathematical Physics'}, {'cat': 'math.MG', 'label': 'Metric Geometry'}, {'cat': 'math.NT', 'label': 'Number Theory'}, {'cat': 'math.NA', 'label': 'Numerical Analysis'}, {'cat': 'math.OA', 'label': 'Operator Algebras'}, {'cat': 'math.OC', 'label': 'Optimization and Control'}, {'cat': 'math.PR', 'label': 'Probability'}, {'cat': 'math.QA', 'label': 'Quantum Algebra'}, {'cat': 'math.RT', 'label': 'Representation Theory'}, {'cat': 'math.RA', 'label': 'Rings and Algebras'}, {'cat': 'math.SP', 'label': 'Spectral Theory'}, {'cat': 'math.ST', 'label': 'Statistics Theory'}, {'cat': 'math.SG', 'label': 'Symplectic Geometry'}, {'cat': 'cs.AI', 'label': 'Artificial Intelligence'}, {'cat': 'cs.CL', 'label': 'Computation and Language'}, {'cat': 'cs.CC', 'label': 'Computational Complexity'}, {'cat': 'cs.CE', 'label': 'Computational Engineering, Finance, and Science'}, {'cat': 'cs.CG', 'label': 'Computational Geometry'}, {'cat': 'cs.GT', 'label': 'Computer Science and Game Theory'}, {'cat': 'cs.CV', 'label': 'Computer Vision and Pattern Recognition'}, {'cat': 'cs.CY', 'label': 'Computers and Society'}, {'cat': 'cs.CR', 'label': 'Cryptography and Security'}, {'cat': 'cs.DS', 'label': 'Data Structures and Algorithms'}, {'cat': 'cs.DB', 'label': 'Databases'}, {'cat': 'cs.DL', 'label': 'Digital Libraries'}, {'cat': 'cs.DM', 'label': 'Discrete Mathematics'}, {'cat': 'cs.DC', 'label': 'Distributed, Parallel, and Cluster Computing'}, {'cat': 'cs.ET', 'label': 'Emerging Technologies'}, {'cat': 'cs.FL', 'label': 'Formal Languages and Automata Theory'}, {'cat': 'cs.GL', 'label': 'General Literature'}, {'cat': 'cs.GR', 'label': 'Graphics'}, {'cat': 'cs.AR', 'label': 'Hardware Architecture'}, {'cat': 'cs.HC', 'label': 'Human-Computer Interaction'}, {'cat': 'cs.IR', 'label': 'Information Retrieval'}, {'cat': 'cs.IT', 'label': 'Information Theory'}, {'cat': 'cs.LG', 'label': 'Learning'}, {'cat': 'cs.LO', 'label': 'Logic in Computer Science'}, {'cat': 'cs.MS', 'label': 'Mathematical Software'}, {'cat': 'cs.MA', 'label': 'Multiagent Systems'}, {'cat': 'cs.MM', 'label': 'Multimedia'}, {'cat': 'cs.NI', 'label': 'Networking and Internet Architecture'}, {'cat': 'cs.NE', 'label': 'Neural and Evolutionary Computing'}, {'cat': 'cs.NA', 'label': 'Numerical Analysis'}, {'cat': 'cs.OS', 'label': 'Operating Systems'}, {'cat': 'cs.OH', 'label': 'Other Computer Science'}, {'cat': 'cs.PF', 'label': 'Performance'}, {'cat': 'cs.PL', 'label': 'Programming Languages'}, {'cat': 'cs.RO', 'label': 'Robotics'}, {'cat': 'cs.SI', 'label': 'Social and Information Networks'}, {'cat': 'cs.SE', 'label': 'Software Engineering'}, {'cat': 'cs.SD', 'label': 'Sound'}, {'cat': 'cs.SC', 'label': 'Symbolic Computation'}, {'cat': 'cs.SY', 'label': 'Systems and Control'}, {'cat': 'q-bio.BM', 'label': 'Biomolecules'}, {'cat': 'q-bio.GN', 'label': 'Genomics'}, {'cat': 'q-bio.MN', 'label': 'Molecular Networks'}, {'cat': 'q-bio.SC', 'label': 'Subcellular Processes'}, {'cat': 'q-bio.CB', 'label': 'Cell Behavior'}, {'cat': 'q-bio.NC', 'label': 'Neurons and Cognition'}, {'cat': 'q-bio.TO', 'label': 'Tissues and Organs'}, {'cat': 'q-bio.PE', 'label': 'Populations and Evolution'}, {'cat': 'q-bio.QM', 'label': 'Quantitative Methods'}, {'cat': 'q-bio.OT', 'label': 'Other'}, {'cat': 'q-fin.PR', 'label': 'Pricing of Securities'}, {'cat': 'q-fin.RM', 'label': 'Risk Management'}, {'cat': 'q-fin.PM', 'label': 'Portfolio Management'}, {'cat': 'q-fin.TR', 'label': 'Trading and Microstructure'}, {'cat': 'q-fin.MF', 'label': 'Mathematical Finance'}, {'cat': 'q-fin.CP', 'label': 'Computational Finance'}, {'cat': 'q-fin.ST', 'label': 'Statistical Finance'}, {'cat': 'q-fin.GN', 'label': 'General Finance'}, {'cat': 'q-fin.EC', 'label': 'Economics'}, {'cat': 'stat.AP', 'label': 'Applications'}, {'cat': 'stat.CO', 'label': 'Computation'}, {'cat': 'stat.ML', 'label': 'Machine Learning'}, {'cat': 'stat.ME', 'label': 'Methodology'}, {'cat': 'stat.OT', 'label': 'Other Statistics'}, {'cat': 'stat.TH', 'label': 'Theory'}
      };
*/

      var categoryNameOptions = {'cs': [{'cat': 'cs.AI', 'label': 'Artificial Intelligence'}, {'cat': 'cs.CL', 'label': 'Computation and Language'}, {'cat': 'cs.CC', 'label': 'Computational Complexity'}, {'cat': 'cs.CE', 'label': 'Computational Engineering, Finance, and Science'}, {'cat': 'cs.CG', 'label': 'Computational Geometry'}, {'cat': 'cs.GT', 'label': 'Computer Science and Game Theory'}, {'cat': 'cs.CV', 'label': 'Computer Vision and Pattern Recognition'}, {'cat': 'cs.CY', 'label': 'Computers and Society'}, {'cat': 'cs.CR', 'label': 'Cryptography and Security'}, {'cat': 'cs.DS', 'label': 'Data Structures and Algorithms'}, {'cat': 'cs.DB', 'label': 'Databases'}, {'cat': 'cs.DL', 'label': 'Digital Libraries'}, {'cat': 'cs.DM', 'label': 'Discrete Mathematics'}, {'cat': 'cs.DC', 'label': 'Distributed, Parallel, and Cluster Computing'}, {'cat': 'cs.ET', 'label': 'Emerging Technologies'}, {'cat': 'cs.FL', 'label': 'Formal Languages and Automata Theory'}, {'cat': 'cs.GL', 'label': 'General Literature'}, {'cat': 'cs.GR', 'label': 'Graphics'}, {'cat': 'cs.AR', 'label': 'Hardware Architecture'}, {'cat': 'cs.HC', 'label': 'Human-Computer Interaction'}, {'cat': 'cs.IR', 'label': 'Information Retrieval'}, {'cat': 'cs.IT', 'label': 'Information Theory'}, {'cat': 'cs.LG', 'label': 'Learning'}, {'cat': 'cs.LO', 'label': 'Logic in Computer Science'}, {'cat': 'cs.MS', 'label': 'Mathematical Software'}, {'cat': 'cs.MA', 'label': 'Multiagent Systems'}, {'cat': 'cs.MM', 'label': 'Multimedia'}, {'cat': 'cs.NI', 'label': 'Networking and Internet Architecture'}, {'cat': 'cs.NE', 'label': 'Neural and Evolutionary Computing'}, {'cat': 'cs.NA', 'label': 'Numerical Analysis'}, {'cat': 'cs.OS', 'label': 'Operating Systems'}, {'cat': 'cs.OH', 'label': 'Other Computer Science'}, {'cat': 'cs.PF', 'label': 'Performance'}, {'cat': 'cs.PL', 'label': 'Programming Languages'}, {'cat': 'cs.RO', 'label': 'Robotics'}, {'cat': 'cs.SI', 'label': 'Social and Information Networks'}, {'cat': 'cs.SE', 'label': 'Software Engineering'}, {'cat': 'cs.SD', 'label': 'Sound'}, {'cat': 'cs.SC', 'label': 'Symbolic Computation'}, {'cat': 'cs.SY', 'label': 'Systems and Control'}], 'econ': [{'cat': 'econ.EM', 'label': 'Econometrics'}, {'cat': 'econ.GN', 'label': 'General Economics'}, {'cat': 'econ.TH', 'label': 'Theoretical Economics'}], 'eess': [{'cat': 'eess.AS', 'label': 'Audio and Speech Processing'}, {'cat': 'eess.IV', 'label': 'Image and Video Processing'}, {'cat': 'eess.SP', 'label': 'Signal Processing'}, {'cat': 'eess.SY', 'label': 'Systems and Control'}], 'math': [{'cat': 'math.AG', 'label': 'Algebraic Geometry'}, {'cat': 'math.AT', 'label': 'Algebraic Topology'}, {'cat': 'math.AP', 'label': 'Analysis of PDEs'}, {'cat': 'math.CT', 'label': 'Category Theory'}, {'cat': 'math.CA', 'label': 'Classical Analysis and ODEs'}, {'cat': 'math.CO', 'label': 'Combinatorics'}, {'cat': 'math.AC', 'label': 'Commutative Algebra'}, {'cat': 'math.CV', 'label': 'Complex Variables'}, {'cat': 'math.DG', 'label': 'Differential Geometry'}, {'cat': 'math.DS', 'label': 'Dynamical Systems'}, {'cat': 'math.FA', 'label': 'Functional Analysis'}, {'cat': 'math.GM', 'label': 'General Mathematics'}, {'cat': 'math.GN', 'label': 'General Topology'}, {'cat': 'math.GT', 'label': 'Geometric Topology'}, {'cat': 'math.GR', 'label': 'Group Theory'}, {'cat': 'math.HO', 'label': 'History and Overview'}, {'cat': 'math.IT', 'label': 'Information Theory'}, {'cat': 'math.KT', 'label': 'K-Theory and Homology'}, {'cat': 'math.LO', 'label': 'Logic'}, {'cat': 'math.MP', 'label': 'Mathematical Physics'}, {'cat': 'math.MG', 'label': 'Metric Geometry'}, {'cat': 'math.NT', 'label': 'Number Theory'}, {'cat': 'math.NA', 'label': 'Numerical Analysis'}, {'cat': 'math.OA', 'label': 'Operator Algebras'}, {'cat': 'math.OC', 'label': 'Optimization and Control'}, {'cat': 'math.PR', 'label': 'Probability'}, {'cat': 'math.QA', 'label': 'Quantum Algebra'}, {'cat': 'math.RT', 'label': 'Representation Theory'}, {'cat': 'math.RA', 'label': 'Rings and Algebras'}, {'cat': 'math.SP', 'label': 'Spectral Theory'}, {'cat': 'math.ST', 'label': 'Statistics Theory'}, {'cat': 'math.SG', 'label': 'Symplectic Geometry'}], 'astro-ph': [{'cat': 'astro-ph.GA', 'label': 'Astrophysics of Galaxies'}, {'cat': 'astro-ph.CO', 'label': 'Cosmology and Nongalactic Astrophysics'}, {'cat': 'astro-ph.EP', 'label': 'Earth and Planetary Astrophysics'}, {'cat': 'astro-ph.HE', 'label': 'High Energy Astrophysical Phenomena'}, {'cat': 'astro-ph.IM', 'label': 'Instrumentation and Methods for Astrophysics'}, {'cat': 'astro-ph.SR', 'label': 'Solar and Stellar Astrophysics'}], 'cond-mat': [{'cat': 'cond-mat.dis-nn', 'label': 'Disordered Systems and Neural Networks'}, {'cat': 'cond-mat.mtrl-sci', 'label': 'Materials Science'}, {'cat': 'cond-mat.mes-hall', 'label': 'Mesoscale and Nanoscale Physics'}, {'cat': 'cond-mat.other', 'label': 'Other Condensed Matter'}, {'cat': 'cond-mat.quant-gas', 'label': 'Quantum Gases'}, {'cat': 'cond-mat.soft', 'label': 'Soft Condensed Matter'}, {'cat': 'cond-mat.stat-mech', 'label': 'Statistical Mechanics'}, {'cat': 'cond-mat.str-el', 'label': 'Strongly Correlated Electrons'}, {'cat': 'cond-mat.supr-con', 'label': 'Superconductivity'}], 'gr-qc': [{'cat': 'gr-qc', 'label': 'General Relativity and Quantum Cosmology'}], 'hep-ex': [{'cat': 'hep-ex', 'label': 'High Energy Physics - Experiment'}], 'hep-lat': [{'cat': 'hep-lat', 'label': 'High Energy Physics - Lattice'}], 'hep-ph': [{'cat': 'hep-ph', 'label': 'High Energy Physics - Phenomenology'}], 'hep-th': [{'cat': 'hep-th', 'label': 'High Energy Physics - Theory'}], 'math-ph': [{'cat': 'math-ph', 'label': 'Mathematical Physics'}], 'nlin': [{'cat': 'nlin.AO', 'label': 'Adaptation and Self-Organizing Systems'}, {'cat': 'nlin.CG', 'label': 'Cellular Automata and Lattice Gases'}, {'cat': 'nlin.CD', 'label': 'Chaotic Dynamics'}, {'cat': 'nlin.SI', 'label': 'Exactly Solvable and Integrable Systems'}, {'cat': 'nlin.PS', 'label': 'Pattern Formation and Solitons'}], 'nucl-ex': [{'cat': 'nucl-ex', 'label': 'Nuclear Experiment'}], 'nucl-th': [{'cat': 'nucl-th', 'label': 'Nuclear Theory'}], 'physics': [{'cat': 'physics.acc-ph', 'label': 'Accelerator Physics'}, {'cat': 'physics.app-ph', 'label': 'Applied Physics'}, {'cat': 'physics.ao-ph', 'label': 'Atmospheric and Oceanic Physics'}, {'cat': 'physics.atom-ph', 'label': 'Atomic Physics'}, {'cat': 'physics.atm-clus', 'label': 'Atomic and Molecular Clusters'}, {'cat': 'physics.bio-ph', 'label': 'Biological Physics'}, {'cat': 'physics.chem-ph', 'label': 'Chemical Physics'}, {'cat': 'physics.class-ph', 'label': 'Classical Physics'}, {'cat': 'physics.comp-ph', 'label': 'Computational Physics'}, {'cat': 'physics.data-an', 'label': 'Data Analysis, Statistics and Probability'}, {'cat': 'physics.flu-dyn', 'label': 'Fluid Dynamics'}, {'cat': 'physics.gen-ph', 'label': 'General Physics'}, {'cat': 'physics.geo-ph', 'label': 'Geophysics'}, {'cat': 'physics.hist-ph', 'label': 'History and Philosophy of Physics'}, {'cat': 'physics.ins-det', 'label': 'Instrumentation and Detectors'}, {'cat': 'physics.med-ph', 'label': 'Medical Physics'}, {'cat': 'physics.optics', 'label': 'Optics'}, {'cat': 'physics.ed-ph', 'label': 'Physics Education'}, {'cat': 'physics.soc-ph', 'label': 'Physics and Society'}, {'cat': 'physics.plasm-ph', 'label': 'Plasma Physics'}, {'cat': 'physics.pop-ph', 'label': 'Popular Physics'}, {'cat': 'physics.space-ph', 'label': 'Space Physics'}], 'quant-ph': [{'cat': 'quant-ph', 'label': 'Quantum Physics'}], 'q-bio': [{'cat': 'q-bio.BM', 'label': 'Biomolecules'}, {'cat': 'q-bio.GN', 'label': 'Genomics'}, {'cat': 'q-bio.MN', 'label': 'Molecular Networks'}, {'cat': 'q-bio.SC', 'label': 'Subcellular Processes'}, {'cat': 'q-bio.CB', 'label': 'Cell Behavior'}, {'cat': 'q-bio.NC', 'label': 'Neurons and Cognition'}, {'cat': 'q-bio.TO', 'label': 'Tissues and Organs'}, {'cat': 'q-bio.PE', 'label': 'Populations and Evolution'}, {'cat': 'q-bio.QM', 'label': 'Quantitative Methods'}, {'cat': 'q-bio.OT', 'label': 'Other'}], 'q-fin': [{'cat': 'q-fin.PR', 'label': 'Pricing of Securities'}, {'cat': 'q-fin.RM', 'label': 'Risk Management'}, {'cat': 'q-fin.PM', 'label': 'Portfolio Management'}, {'cat': 'q-fin.TR', 'label': 'Trading and Microstructure'}, {'cat': 'q-fin.MF', 'label': 'Mathematical Finance'}, {'cat': 'q-fin.CP', 'label': 'Computational Finance'}, {'cat': 'q-fin.ST', 'label': 'Statistical Finance'}, {'cat': 'q-fin.GN', 'label': 'General Finance'}, {'cat': 'q-fin.EC', 'label': 'Economics'}], 'stat': [{'cat': 'stat.AP', 'label': 'Applications'}, {'cat': 'stat.CO', 'label': 'Computation'}, {'cat': 'stat.ML', 'label': 'Machine Learning'}, {'cat': 'stat.ME', 'label': 'Methodology'}, {'cat': 'stat.OT', 'label': 'Other Statistics'}, {'cat': 'stat.TH', 'label': 'Theory'}]};

      if (!archive.length) {
        categoryNameSelect.clear();
        categoryNameSelect.clearOptions();
        return;
      } else {
      // if (archive === "cs") {
        categoryNameSelect.disable();
        console.log("selectize archive: " + archive);
        categoryNameSelect.clear();
        categoryNameSelect.clearOptions();
        categoryNameSelect.load(function(callback) {
          callback(categoryNameOptions[archive]);
        });
        categoryNameSelect.enable();
      // } else {
      //   categoryNameSelect.clear();
      //   categoryNameSelect.clearOptions();
      //   return;
      }
    }

    var $select = $('#creator').selectize({
        delimiter: ',',
        persist: false,
        maxItems: 1,
        plugins: ['remove_button', 'enter_key_submit'],
        onInitialize: function () {
          this.on('submit', function () {
            this.$input.closest('form').submit();
          }, this);
        },
        valueField: 'cat',
        labelField: 'label',
        searchField: ['cat', 'label'],
        options: [
          {'cat': 'TeX', 'label': '14174'}, {'cat': 'SM', 'label': '13097'}, {'cat': 'OriginLab', 'label': '8876'}, {'cat': 'GIMP', 'label': '10730'}, {'cat': 'R', 'label': '9195'}, {'cat': 'MATLAB', 'label': '50808'}, {'cat': 'Mathematica', 'label': '27606'}, {'cat': 'ImageMagick', 'label': '6323'}, {'cat': 'jpeg2ps', 'label': '4198'}, {'cat': 'fig2dev', 'label': '16680'}, {'cat': 'PGPLOT', 'label': '6259'}, {'cat': 'cairo', 'label': '22867'}, {'cat': 'gnuplot', 'label': '20207'}, {'cat': 'Grace', 'label': '11678'}, {'cat': 'PScript5', 'label': '3704'}, {'cat': 'matplotlib', 'label': '47145'}, {'cat': '', 'label': '2578'}, {'cat': 'Keynote', 'label': '2735'}, {'cat': 'LaTeX', 'label': '2321'}, {'cat': 'Illustrator', 'label': '14408'}, {'cat': 'inkscape', 'label': '2388'}, {'cat': 'PowerPoint', 'label': '3487'}, {'cat': 'dvips', 'label': '11680'}, {'cat': 'Preview', 'label': '1530'}, {'cat': 'FreeHEP', 'label': '1283'}, {'cat': 'HIGZ', 'label': '7000'}, {'cat': 'CorelDRAW', 'label': '4745'}, {'cat': 'PSCRIPT', 'label': '1659'}, {'cat': 'gnome-screenshot', 'label': '1058'}, {'cat': 'Wolfram', 'label': '1180'}, {'cat': 'xmgr', 'label': '1859'}, {'cat': 'TECPLOT', 'label': '907'}, {'cat': 'Acrobat', 'label': '3996'}, {'cat': 'Unknown', 'label': '1086'}, {'cat': 'Draw', 'label': '855'}, {'cat': 'Unified', 'label': '960'}, {'cat': 'XV', 'label': '2243'}, {'cat': 'IDL', 'label': '19590'}, {'cat': 'fko', 'label': '811'}, {'cat': 'ImageReady', 'label': '755'}, {'cat': 'Sun', 'label': '761'}, {'cat': 'Maple', 'label': '760'}, {'cat': 'Office', 'label': '704'}, {'cat': 'Ipe', 'label': '2662'}, {'cat': 'pdfresizer', 'label': '628'}, {'cat': 'Chromium', 'label': '597'}, {'cat': 'Tk', 'label': '595'}, {'cat': 'Ghostscript', 'label': '10191'}, {'cat': 'dvipsk', 'label': '835'}, {'cat': 'pnmtops', 'label': '532'}, {'cat': 'Mathematica-PSRender', 'label': '511'}, {'cat': 'ROOT', 'label': '14147'}, {'cat': 'IgorPro', 'label': '501'}, {'cat': 'EPS-conv', 'label': '530'}, {'cat': 'TRIUMF', 'label': '419'}, {'cat': 'AIPS', 'label': '364'}, {'cat': 'GTVIRT', 'label': '1026'}, {'cat': 'Administrator', 'label': '378'}, {'cat': '3-Heights', 'label': '430'}, {'cat': 'Visio', 'label': '829'}, {'cat': 'ImageMark', 'label': '317'}, {'cat': 'Quartz', 'label': '315'}, {'cat': 'Impress', 'label': '308'}, {'cat': 'Igor', 'label': '467'}, {'cat': '0', 'label': '359'}, {'cat': 'Photoshop', 'label': '4403'}, {'cat': 'OmniGraffle', 'label': '1933'}, {'cat': 'ACE/gr', 'label': '750'}, {'cat': 'Photo', 'label': '227'}, {'cat': 'imgtops', 'label': '233'}, {'cat': '()', 'label': '214'}, {'cat': 'MapleV', 'label': '202'}, {'cat': 'NT', 'label': '207'}, {'cat': 'jpeg2eps', 'label': '194'}, {'cat': 'Gist', 'label': '185'}, {'cat': 'QtiPlot', 'label': '174'}, {'cat': 'GLE', 'label': '344'}, {'cat': 'user', 'label': '319'}, {'cat': 'xpdf/pdftops', 'label': '317'}, {'cat': 'GraphicConverter', 'label': '1195'}, {'cat': 'Pages', 'label': '154'}, {'cat': 'Ipelib', 'label': '660'}, {'cat': 'Online2PDF', 'label': '147'}, {'cat': 'Serif', 'label': '204'}, {'cat': 'Shotwell', 'label': '447'}, {'cat': 'Jasc', 'label': '181'}, {'cat': 'EpsGraphics', 'label': '133'}, {'cat': 'Google', 'label': '139'}, {'cat': 'Tgif', 'label': '726'}, {'cat': 'Shutter', 'label': '123'}, {'cat': 'TriMetrix', 'label': '120'}, {'cat': 'sgi2ueps', 'label': '118'}, {'cat': 'Feynman', 'label': '115'}, {'cat': 'PSIKern', 'label': '111'}, {'cat': 'Aladdin', 'label': '191'}, {'cat': 'PyX', 'label': '359'}, {'cat': 'Lick', 'label': '209'}, {'cat': 'LibreOffice', 'label': '447'}, {'cat': 'module', 'label': '160'}, {'cat': 'KaleidaGraph', 'label': '623'}, {'cat': 'Word', 'label': '334'}, {'cat': 'David', 'label': '174'}, {'cat': 'Mayura', 'label': '371'}, {'cat': 'proFit', 'label': '90'}, {'cat': 'Dia', 'label': '275'}, {'cat': 'Zamzar', 'label': '81'}, {'cat': 'GKS', 'label': '76'}, {'cat': 'GRA2PS', 'label': '307'}, {'cat': 'yExport', 'label': '124'}, {'cat': 'Image', 'label': '204'}, {'cat': 'https', 'label': '70'}, {'cat': 'XnView', 'label': '72'}, {'cat': 'Micrografx', 'label': '79'}, {'cat': 'pdftk', 'label': '174'}, {'cat': 'psmerge', 'label': '66'}, {'cat': 'Canvas', 'label': '423'}, {'cat': 'GL2PS', 'label': '136'}, {'cat': 'Autodesk', 'label': '62'}, {'cat': 'Paint', 'label': '377'}, {'cat': 'VTK', 'label': '62'}, {'cat': 'BI', 'label': '62'}, {'cat': 'RAD', 'label': '61'}, {'cat': 'Apache', 'label': '82'}, {'cat': 'Picasa', 'label': '63'}, {'cat': 'meitu', 'label': '58'}, {'cat': 'TpX', 'label': '57'}, {'cat': 'AutoCAD', 'label': '108'}, {'cat': 'PrimoPDF', 'label': '57'}, {'cat': 'Anteprima', 'label': '55'}, {'cat': 'GPLOT', 'label': '53'}, {'cat': 'GSS', 'label': '53'}, {'cat': 'Graphic', 'label': '74'}, {'cat': 'Excel', 'label': '210'}, {'cat': 'admin', 'label': '115'}, {'cat': 'InDesign', 'label': '87'}, {'cat': 'SciPlot', 'label': '61'}, {'cat': 'SigmaPlot', 'label': '114'}, {'cat': 'tiff2ps', 'label': '53'}, {'cat': '', 'label': '52'}, {'cat': 'GeoGebra', 'label': '51'}, {'cat': 'Octave', 'label': '50'}, {'cat': 'Tailor', 'label': '50'}, {'cat': '', 'label': '54'}, {'cat': 'DeskScan', 'label': '53'}, {'cat': 'MetaPost', 'label': '314'}, {'cat': 'SM230', 'label': '48'}, {'cat': 'C-PLOT', 'label': '51'}, {'cat': 'LaTeXiT', 'label': '47'}, {'cat': 'imgtops2', 'label': '47'}, {'cat': 'iDraw', 'label': '77'}, {'cat': 'dasmus', 'label': '49'}, {'cat': 'FreeHand', 'label': '229'}, {'cat': 'gelis', 'label': '44'}, {'cat': 'Id', 'label': '55'}, {'cat': 'Aperu', 'label': '43'}, {'cat': '050ImageMagick', 'label': '48'}, {'cat': 'Diagramm', 'label': '44'}, {'cat': 'libplot', 'label': '114'}, {'cat': 'Axum', 'label': '77'}, {'cat': 'Dietrich', 'label': '43'}, {'cat': 'Mongo2k', 'label': '41'}, {'cat': '', 'label': '41'}, {'cat': 'ESO-MIDAS', 'label': '40'}, {'cat': 'PDFium', 'label': '40'}, {'cat': 'a10004', 'label': '40'}, {'cat': 'ctioga2', 'label': '54'}, {'cat': 'IrfanView', 'label': '38'}, {'cat': 'Xara', 'label': '44'}, {'cat': 'Xvgr', 'label': '52'}, {'cat': 'ACDSee', 'label': '53'}, {'cat': 'PS4', 'label': '182'}, {'cat': 'EpsGraphics2D', 'label': '70'}, {'cat': 'Frank', 'label': '67'}, {'cat': 'KnotPlot', 'label': '37'}, {'cat': 'R/RGL', 'label': '37'}, {'cat': 'UnknownApplication', 'label': '37'}, {'cat': 'Veusz', 'label': '492'}, {'cat': 'diagrams', 'label': '37'}, {'cat': 'GraphicsMagick', 'label': '55'}, {'cat': 'CLARIS', 'label': '37'}, {'cat': '050MATLAB', 'label': '208'}, {'cat': 'lenovo', 'label': '73'}, {'cat': 'programmed', 'label': '36'}, {'cat': 'Artifex', 'label': '36'}, {'cat': 'MiKTeX', 'label': '184'}, {'cat': 'wPDF', 'label': '35'}, {'cat': 'SuperPaint', 'label': '36'}, {'cat': 'WJpeg2ps', 'label': '34'}, {'cat': 'Diagram', 'label': '34'}, {'cat': 'Greenshot', 'label': '33'}, {'cat': 'PIL', 'label': '33'}, {'cat': 'Vista', 'label': '33'}, {'cat': 'GMT', 'label': '32'}, {'cat': 'RAL', 'label': '204'}, {'cat': 'Visualization', 'label': '33'}, {'cat': 'Writer', 'label': '32'}, {'cat': 'Alex', 'label': '85'}, {'cat': '/fig2dev', 'label': '32'}, {'cat': 'Corel', 'label': '233'}, {'cat': 'PDFaid', 'label': '31'}, {'cat': 'akartavt', 'label': '31'}, {'cat': 'dell', 'label': '50'}, {'cat': 'figps', 'label': '31'}, {'cat': '/cygdrive/c/windows/fig2dev', 'label': '31'}, {'cat': 'Altsys', 'label': '30'}, {'cat': 'Jmol', 'label': '31'}, {'cat': 'Word2TeX', 'label': '32'}, {'cat': 'CLShan', 'label': '28'}, {'cat': 'ImageEn', 'label': '28'}, {'cat': 'Tailor_Mac_To_EPS', 'label': '28'}, {'cat': 'graphviz', 'label': '154'}, {'cat': 'thomasfiedler', 'label': '28'}, {'cat': 'Asymptote', 'label': '187'}, {'cat': 'psk', 'label': '27'}, {'cat': 'ACD', 'label': '29'}, {'cat': 'Aspose', 'label': '26'}, {'cat': 'elendil', 'label': '26'}, {'cat': 'jlibeps', 'label': '28'}, {'cat': 'stefano', 'label': '36'}, {'cat': 'Pyxplot', 'label': '73'}, {'cat': 'marco', 'label': '52'}, {'cat': 'CoHort', 'label': '35'}, {'cat': 'Markus', 'label': '39'}, {'cat': 'PageDraw', 'label': '25'}, {'cat': 'hp2xx', 'label': '31'}, {'cat': 'Maurice', 'label': '26'}, {'cat': 'PS5', 'label': '72'}, {'cat': 'Camelot', 'label': '22'}, {'cat': 'DECW', 'label': '23'}, {'cat': 'FeynArts', 'label': '22'}, {'cat': 'Mirage', 'label': '22'}, {'cat': 'PDF24', 'label': '22'}, {'cat': 'Pajek', 'label': '25'}, {'cat': 'convert-jpg-to-pdf', 'label': '22'}, {'cat': '3-D', 'label': '21'}, {'cat': 'Create', 'label': '21'}, {'cat': 'Macromedia', 'label': '36'}, {'cat': 'Windows', 'label': '44'}, {'cat': 'bcarry', 'label': '22'}, {'cat': 'garel', 'label': '29'}, {'cat': 'Andrea', 'label': '52'}, {'cat': 'FeynDiagram', 'label': '66'}, {'cat': 'S-PLUS', 'label': '42'}, {'cat': 'Topdraw', 'label': '29'}, {'cat': 'Vorschau', 'label': '21'}, {'cat': 'WPS', 'label': '35'}, {'cat': 'boram', 'label': '20'}, {'cat': 'chavanis', 'label': '29'}, {'cat': 'dvi2ps', 'label': '20'}, {'cat': 'grass', 'label': '20'}
        ],
        render: {
          item: function(item, escape) {
              return '<div>' +
                  (item.cat ? '<span class="cat">' + escape(item.cat) + ' </span>' : '') +
                  (item.label ? '<span class="label small">(' + escape(item.label) + ' in total)</span>' : '') +
              '</div>';
          },
          option: function(item, escape) {
              var label = item.cat || item.label;
              var caption = item.cat ? item.label : null;
              return '<div>' +
                  '<span class="label">' + escape(label) + ' </span>' +
                  (caption ? '<span class="caption small">(' + escape(caption) + ' in total)</span>' : '') +
              '</div>';
          }
        },
        create: function(input) {
            return {
                cat: input,
                label: input
            }
        }
    });
    var creatorSelect = $select[0].selectize;

    var $ifSelect = $('#imageformat').selectize({
        create: false,
        // sortField: 'text'
        plugins: ['remove_button', 'enter_key_submit'],
        onInitialize: function () {
          this.on('submit', function () {
            this.$input.closest('form').submit();
          }, this);
        },
    });
    var ifSelect = $ifSelect[0].selectize;

    var titleSelect = $('#title').selectize({
        create: true,
        // sortField: 'text'
        maxItems: 1,
        plugins: ['remove_button', 'enter_key_submit'],
        onInitialize: function () {
          this.on('submit', function () {
            this.$input.closest('form').submit();
          }, this);
        },
        persist: true,
    });
    var titleSelect = titleSelect[0].selectize;

    var captionSelect = $('#caption').selectize({
        create: true,
        // sortField: 'text'
        maxItems: 1,
        plugins: ['remove_button', 'enter_key_submit'],
        onInitialize: function () {
          this.on('submit', function () {
            this.$input.closest('form').submit();
          }, this);
        },
    });
    var captionSelect = captionSelect[0].selectize;

    // activate tooltips
    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    })

    // $('.input-daterange input').each(function() {
    //   $(this).datepicker('clearDates');
    // });

    // $('[data-toggle="popover"]').popover({
    //   offset: '50',
    //   // placement: 'top',
    //   // trigger: 'click',
    // });


    {% if prev_image_id %}
      $("#image_id").val( {{ prev_image_id }} );

      // $('#image-grid').removeClass('image-grid');
    {% endif %}

    {% if embedding %}
      console.log({{embedding|tojson}});
      var emVal = {{embedding|tojson}};
      $("#embedding").val(emVal);
    {% endif %}

    console.log({{search_select|tojson}});
    var emVal = {{search_select|tojson}};
    if(emVal === "on") {
      console.log("toggling checkbox");
      $("#search_select").val("on");
      checkbox.checked = 1;
    }
    toggleMode();


    {% if imageformat or author or prediction or title or creator or caption or date_start or date_end %}
      console.log("some filters active");
      // var collapsible = document.getElementsByClassName("collapsible");
      // collapsible.collapse("toggle");
      $("#filter-content").collapse('toggle');
    {% endif %}

    {% if category %}
      console.log({{category|tojson}});
      var catVal = {{category|tojson}};
      categorySelect.setValue(catVal.split(","), 1);
      loadCategoryName({{category|tojson}});
    {% endif %}
    // selectize.setValue(["cs.CV","astro-ph.GA"], 1);

    {% if category_name %}
      console.log({{category_name|tojson}});
      var catVal = {{category_name|tojson}};
      categoryNameSelect.setValue(catVal.split(","), 1);
    {% endif %}

    {% if imageformat %}
      console.log({{imageformat|tojson}});
      var imVal = {{imageformat|tojson}};
      ifSelect.setValue(imVal, 1);
    {% endif %}
    // selectize.setValue(["cs.CV","astro-ph.GA"], 1);

    {% if author %}
      console.log({{author|tojson}});
      var authorVal = {{author|tojson}};
      // $("#author").val(authorVal);
      authorSelect.setValue(authorVal, 1);
    {% endif %}

    {% if prediction %}
      console.log({{prediction|tojson}});
      var predVal = {{prediction|tojson}};
      // $("#prediction").val(predVal);
      predictionSelect.addOption({value:predVal,text:predVal});
      predictionSelect.setValue(predVal, 1);
    {% endif %}

    {% if title %}
      console.log({{title|tojson}});
      var titleVal = {{title|tojson}};
      // $("#prediction").val(predVal);
      titleSelect.addOption({value:titleVal,text:titleVal});
      titleSelect.setValue(titleVal, 1);
    {% endif %}

    {% if creator %}
      console.log({{creator|tojson}});
      var creatorVal = {{creator|tojson}};
      // $("#prediction").val(predVal);
      creatorSelect.setValue(creatorVal, 1);
    {% endif %}

    {% if caption %}
      console.log({{caption|tojson}});
      var captionVal = {{caption|tojson}};
      // $("#prediction").val(predVal);
      captionSelect.addOption({value:captionVal,text:captionVal});
      captionSelect.setValue(captionVal, 1);
    {% endif %}

    {% if date_start %}
      console.log({{date_start|tojson}});
      var dsVal = {{date_start|tojson}};
      var ds = document.getElementById("date-start");
      ds.value = dsVal;
    {% endif %}

    {% if date_end %}
      console.log({{date_end|tojson}});
      var deVal = {{date_end|tojson}};
      var de = document.getElementById("date-end");
      de.value = deVal;
    {% endif %}

    console.log( {{ metadict|tojson }} );
    console.log( {{ si_meta_d|tojson }} );

    // window.MathJax = {
    //   tex: {
    //     inlineMath: [['$', '$'], ['\\(', '\\)']]
    //   }
    // };

    $('#container').imagesLoaded()
    .always( function( instance ) {
      console.log('all images loaded');
    })
    .done( function( instance ) {
      console.log('all images successfully loaded');
    })
    .fail( function() {
      console.log('all images loaded, at least one is broken');
    })
    .progress( function( instance, image ) {
      var result = image.isLoaded ? 'loaded' : 'broken';
      console.log( 'image is ' + result + ' for ' + image.img.src );
    });
  });

  $(window).on('load', function(){
		$(".wrapper").animate({
			opacity: 1
		});
		$('#loading').hide()
	})

  </script>

{% endblock %}
